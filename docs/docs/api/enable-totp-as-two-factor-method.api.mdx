---
id: enable-totp-as-two-factor-method
title: "Enable TOTP as 2FA Method"
description: "Complete the TOTP setup `token` from [`GET /api/auth/2fa/setup`](../../docs/api/get-totp-setup-details)"
sidebar_label: "Enable TOTP as 2FA Method"
hide_title: true
hide_table_of_contents: true
api: eJztGm1z2sj5r2zlmbZhEPic67TjD51yWE64w8AAjpOxPXgtLaCL0Kq7KxPG4//e53lWQhLghMTcTKf1l8Ssdp/3991Hx/CZdk6vnfFSuufcN1KxVmrmIjahz00oY+e27gRC+ypM6Oep05aLJBJGMNjGxv3xgGlh0oTdGflZxHdsquSCXd+988asyZOwyQFe82TKm7Tt7vavc2MSfdps6jCepRFXoVk1tBFKyIdGKJuB9DUdnAnjGmkSlw66gTA8jPQbdhPzOGDc4vZlICxKHjNekA6M8CRp3MQ38SeZMh++RoKrmC2kEozfy9QAA6Fm13PAvB9RszQEUViGDAhsSgI7IvLeEKoWu9bCT/E045FQ5vsB5+ddOq+PQHKuToQfTkM/W3tzEy/DKGL3AkQfAx+SdJFqof6imViAmFg4tewBcQYwM/hTxPw+EiC5OLiJs13Af2kZpBlPw1mqBP6plPBNtPouFghsMwdDFmQlc3R0xIbi32moxAJo1jexy8YZ0aSdku5wFWlOuNZLqYIGOzlvMWI5lobB0mf4Zeasj7Z60gCLYATM/maJkg9AjbJHHngUBjyzV5CuBD6t5qyQMhpyMYSGTeETrudwGgjfstCVPujAqjqiv4l41ITVEUCwx0G0CvgV2iB9SJ0VeUVzYWypWp+1MBtfMdoMK5wkeD9iwFZJRoAfg1y0VVBnCsJdQ9cFTXUiEZwpykKCZoGY8jRa05KzBHIMvkZ6bhaoW4S5Aeb7GXnGzsYYiMjCWlb7EI5avi+0pi97hqCKtxPEI05AXPr1hmUaBotGrsvIRkYkl8kLkcGWxIW4Z7GhCZYRgr3DT/rG9FymUcAW3Phza8zoyxpIBbGg1CFwxmja1toqsmg4dUd8AWpiHp0BJc7po5OqCOL8SyOi81R3ZCKscjoBQLQuNoaQ3tKQcGy+uRBmLgOgIuGKLyCvKExIj04MP+CMtQ34HGLuAX9SK/iRi8E5nfJIi7qj/TlYNRJvVgme0wbNzHl6urW7wQ9/kcEKd6BAwPnwz5JVN3/XmN4et0HJ+98hECKFCvkxoSApkex3YKw7mJNKH0JANxMKAEBkACXZpbcnQFyZk2t7rp4BBrpNaCIEsJbVB6HC6WqE0h1angBGBYhRqaAFnYCjWkJPjo/xv2oWH6VkBKj+kjxqzdr3iACiqRJmpwwwcWM0vkRb2vEdcot8AGW2gWdd2sGV4qjhEMKT3qXP+rOC35BmFUM9JzY/XyVxl7QzOVtJoqABwcnx37dlicF9KqNILjGyCaUgAaAutU2iCCCwSRrjquEm1ac3cY3VaneD/mg8afcvLjrjyahz5k2883OvPZ6ctzrdy6F3d1qrMe+LLwgVeH8C4DBLAh4OWSyMIFcjaFAKGhcsavBIJqZT0BfjU4PBgGmr7GkaMciE/J5rwdauuWECL3KJcAE2yRfJTpVbzvdyjC0fKqCQeHd+Adyaz3afSriZf9tkMge0KNYE10t8lezEw10b5vH2+OeDmsf4qg+m0B73h5MLb/y+fzZpdYde6+zTxOu1ful6Z2Qg43XkLVdRaDALCq6YOHikBA9WeZnzqvTDKf3nXfH1BUrv9SeD1mh01R+eTQbD/gcIC0Or57xWjYUIMPljdQ/undfJlOCLWECgwSxeffzA6v7poOputdveaDQZ93/zehPv46AzzNy6EwfUDYGm59zYKpzieFb2YUv3JcnKz21Qnd6HVrezHygo17GzuseaHMleQxyNvcHkcrAfdVnF+ix5VWDfoK8KbE8CLzqjUaf3LvMWJZcxW0I83E3dItRY2+aQcJwwGXnjfbktjT6eY3gL5Dd43gL5LNtbkL/G+S5KN5i/GvZ77yaldNPun9nq40pJbNeKFIN0vMaTQ8aTw9YMlyNvOOn1oYbsX/asqV1S0pA42Ujj19x/QOX97cC5vxLBW91u/6rbgQ4Baz7w7kpbMMybAY2jT7FuEkIbV6otAsUCrADz2QtH8qJQ22kXzt+q+QAMII8NZ61x65fWyNuvKZmJGBqLaI1ZCRwyEb/bvYfewuH12sNPg3Gn3zscOhH7amVPb2N+3xq9fzGqOddz3LQNPov4E/LKs3778sLrjQlPK58PAgiq6gLppzgbZUuOZiGVHdlwVKmdLFmvqeSAMuXFQDybeSITSG2RN3JyBsNOr90ZtLrP05SAx/hhAgzvTdhrYDlQYHmicQXdA9AwjBcTu/fgxMDp6fUtgl3PGYvlp3plf1vKz6HY2l8s44TM9olASiI1KYOYdKr3NzgvsZc4NE1RD/mobp95obN5jXQmFti/IBQHSS6AAAya+s2BltN/HEOE3TxLU3goiR5EJBOyzBzQbSG4EZpaZk35SKd6t1URRDGBSsLfxGoLp4dDcxrAVU5DTLVuBlG0NGbZ6MPptsLO/3E0mzds9XKwxjuO8oR3xxj9R++q7EC5qOHcKnnZiBndN5u6wtaJ3Tqpbp3kwzMax/pWdmCtOwx0LVAkd0ucrXK6QeHZuXUFWYMdXAaVCT4yTAEJqbwHFBRB7B/neRz59Wq8weC+FrMXi388h5lK7fpz+tsRGQ7hEACVQdex4Q08L42ymkNOGTktplQtUwWLh5dL9TqlJBj8MEmT5yTztdixZeqvsePU+egWjwncqtDcrwsiF/7cipVS6hRMYv4dcWVoT2ReB6VZVtCwWCwrNe4fYGIZtT8QXXYk8v8X9/vo4m2pe5m8yDj2DVr/XeaRiSD7sDsCAaNYPA+LO0zvC8cXOKU7yLwKzYvd4ycEMpW2krZF5qgglrUGnS3JXInIlwuRPyaplfbX/sTwap1unPNewJoS3bBpOkDXC8Cbm1LHFSQyxNb0Jp5uXUvUbSZc8BiKbARWzx+fYOtQWreTMSILOjG39DqFgiL0NGUq6f6/VjsHe4E90BXjbPxdxGNf1Gqn+NGFFqgakdif7XDkYo3Tjub8KMV+HdyTaLf4VNl4dB2jbp3entjo/FAyXcuRkpFwsQUNcttCHmE1e1GC9JxBlwpUtDPmq4R4azmiFLHLUTjQB98lgvgumSFovQJ7XFjx6TRJpAIQizQyoQvymKWwNz9aXz/LwIshZvhsBvAt/fdpGBkXWj2EucEB9IqgE9rB7lrQuPmRuGN+BOnJ3jdpmT+gCUrsDuzlBCoFuB5ltXp+uwGGiYct1IzFKVgcBKkYoQUpXWe4dpIB5Fj5h6QvFIvChz5RuAhtz07PIPDaNxOQleFMlTIrqFcuqI//LFagMWvZjbXBZyRxOzsrgivSaFHK+xQCyD33wSoC6kRCkFSdLUJfyeInnAFnSKPIhQbQ/1x5UUPo/lmr9aQRKIsRmnzhRFlex/EyHAmLlzSWHHDZe7F5swd2gu6fhZiRDU/wbaNZKzdoZMYUeuj4v0ofIaAAZoH9aQH03aD78JZ1s/VN0MvlsjGL04ZUs2Z2FsJiErlvG8cNETfmZhEhXIwgNgT9BB+OqceGzg8UVkLlEXN2wsE11TvrhyOVOFZ63vH6UvH1peLrS8XXl4qvLxX/Z14qZsW9EV9ME0wCCuWnLO08ZjPLa6z8YSfSB/9BTMpeetHMEmeXt3UHJ4u49fERi7NLFT094bJ9XYgTzSDU5GPr94VQG5QfI4L4UiSEBo4PICjcbYeveYOCYOyprLRzx0h8cXZrPI5TUHsC2U5MaS++y6vMafHdGHaT2ZPGBZX9juJLfBwJ/wJp+PqSnAA30Nqjkxd/8N2ixPaCRFV0ThutKjGSN1XxqkQUSI92kHpAgrmUbFPydAvA/wMNIht/
sidebar_class_name: "post api-method"
info_path: docs/api/singularity-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Enable TOTP as 2FA Method"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/auth/2fa/totp/setup"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Complete the TOTP setup `token` from [`GET /api/auth/2fa/setup`](../../docs/api/get-totp-setup-details) 
and a TOTP code from an authenticator app.

You can learn more about this [here](../../docs/guides/auth/two-factor#setup).

A [security alert](../../docs/guides/auth/security-alerts#2fa-specific-alerts)
will be sent to the user's email if this setting is enabled and
email is [enabled and configured correctly](../../docs/guides/email/configuration).

### Requirements
- The user can authenticate using password. 2FA will not work with OAuth2. 
  The OAuth2 provider will validate the second factor if the user enabled it for the provider.
  
### Locale

A locale can be specified for this request. 
The email will be sent in the specified locale.
You can learn more about locale in emails [here](../../docs/guides/email/templates).

If no locale is specified, the applications default locale will be used.
You can learn more about configuring the default locale [here](../../docs/guides/configuration).

### Tokens
- A valid [`AccessToken`](../../docs/guides/auth/tokens#access-token) is required.
- A valid [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  is required. This token should match user and session contained in the `AccessToken`.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={[{"name":"locale","in":"query","required":false,"schema":{"type":"string"}}]}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string"},"code":{"type":"integer","format":"int32"}},"required":["code","token"],"title":"TwoFactorVerifySetupRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Success.","content":{"*/*":{"schema":{"type":"object","properties":{"secret":{"type":"string"},"totpAuthUrl":{"type":"string"},"recoveryCodes":{"type":"array","items":{"type":"string"}},"token":{"type":"string"}},"required":["recoveryCodes","secret","token","totpAuthUrl"],"title":"TwoFactorSetupResponse"}}}},"207":{"description":"The following error codes correspond to this status:\n* **`POST_COMMIT_SIDE_EFFECT_FAILURE`:** Exception representing a failure to perform a side effect after a successful database operation.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"304":{"description":"The following error codes correspond to this status:\n* **`TWO_FACTOR_METHOD_ALREADY_ENABLED`:** Two-factor authentication method is already enabled.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"400":{"description":"The following error codes correspond to this status:\n* **`NO_PASSWORD_PROVIDER`:** The user needs to set a password in to perform this action.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"401":{"description":"The following error codes correspond to this status:\n* **`ACCESS_TOKEN_EXPIRED`:** Indicates that the access token is expired.\n* **`ACCESS_TOKEN_INVALID`:** Indicates that the access token cannot be decoded.\n* **`STEP_UP_TOKEN_EXPIRED`:** Indicates that the step-up token is expired.\n* **`STEP_UP_TOKEN_INVALID`:** Indicates that the step-up token cannot be decoded.\n* **`STEP_UP_TOKEN_MISSING`:** Thrown when the step-up token is missing.\n* **`TOTP_SETUP_TOKEN_EXPIRED`:** Indicates that the TOTP setup token is expired.\n* **`TOTP_SETUP_TOKEN_INVALID`:** Indicates that the TOTP setup token cannot be decoded.\n* **`TOTP_SETUP_TOKEN_MISSING`:** Thrown when the TOTP setup token is missing.\n* **`WRONG_TWO_FACTOR_CODE`:** Wrong two-factor code.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"404":{"description":"The following error codes correspond to this status:\n* **`USER_NOT_FOUND`:** User not found.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"500":{"description":"The following error codes correspond to this status:\n* **`ACCESS_TOKEN_ALLOWLIST_READING_FAILURE`:** Represents an exception indicating a failure when reading the allowlist for an access token cache.\n* **`DATABASE_FAILURE`:** Exception representing a general failure related to database operations.\n* **`DATABASE_ENCRYPTION_FAILURE`:** Exception representing a general failure related to database encryption operations.\n* **`HASH_FAILURE`:** Exception representing a general failure related to hashing operations.\n* **`INVALID_USER_DOCUMENT`:** A requested user document was stored in an invalid format.\n* **`TOTP_FAILURE`:** TOTP code validation failed.\n* **`INVALID_PRINCIPAL_DOCUMENT`:** A requested principal document was stored in an invalid format.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}}}}
>
  
</StatusCodes>


      