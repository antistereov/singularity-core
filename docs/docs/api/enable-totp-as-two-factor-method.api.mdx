---
id: enable-totp-as-two-factor-method
title: "Enable TOTP as 2FA Method"
description: "Complete the TOTP setup `token` from [`GET /api/auth/2fa/setup`](../../docs/api/get-totp-setup-details)"
sidebar_label: "Enable TOTP as 2FA Method"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/singularity-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Enable TOTP as 2FA Method"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/auth/2fa/totp/setup"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Complete the TOTP setup `token` from [`GET /api/auth/2fa/setup`](../../docs/api/get-totp-setup-details) 
and a TOTP code from an authenticator app.

You can learn more about this [here](../../docs/guides/auth/two-factor#setup).

A [security alert](../../docs/guides/auth/security-alerts#2fa-specific-alerts)
will be sent to the user's email if this setting is enabled and
email is [enabled and configured correctly](../../docs/guides/email/configuration).

### Requirements
- The user can authenticate using password. 2FA will not work with OAuth2. 
  The OAuth2 provider will validate the second factor if the user enabled it for the provider.
  
### Locale

A locale can be specified for this request. 
The email will be sent in the specified locale.
You can learn more about locale in emails [here](../../docs/guides/email/templates).

If no locale is specified, the applications default locale will be used.
You can learn more about configuring the default locale [here](../../docs/guides/configuration).

### Tokens
- A valid [`AccessToken`](../../docs/guides/auth/tokens#access-token) is required.
- A valid [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  is required. This token should match user and session contained in the `AccessToken`.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={[{"name":"locale","in":"query","required":false,"schema":{"type":"string"}}]}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string"},"code":{"type":"integer","format":"int32"}},"required":["code","token"],"title":"TwoFactorVerifySetupRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Success.","content":{"*/*":{"schema":{"type":"object","properties":{"secret":{"type":"string"},"totpAuthUrl":{"type":"string"},"recoveryCodes":{"type":"array","items":{"type":"string"}},"token":{"type":"string"}},"required":["recoveryCodes","secret","token","totpAuthUrl"],"title":"TwoFactorSetupResponse"}}}},"207":{"description":"A specific domain error occurred (see list below):\n* **`POST_COMMIT_SIDE_EFFECT_FAILURE`:** Exception representing a failure to perform a side effect after a successful database operation.\n* **`USER_AVATAR_MAPPING_FAILURE`:** Failed to map avatar metadata.\n* **`POST_COMMIT_SIDE_EFFECT_FAILURE`:** Exception representing a failure to perform a side effect after a successful database operation.\n* **`USER_AVATAR_MAPPING_FAILURE`:** Failed to map avatar metadata.","content":{"application/json":{"schema":{}}}},"304":{"description":"A specific domain error occurred (see list below):\n* **`TWO_FACTOR_METHOD_ALREADY_ENABLED`:** Two-factor authentication method is already enabled.\n* **`TWO_FACTOR_METHOD_ALREADY_ENABLED`:** Two-factor authentication method is already enabled.","content":{"application/json":{"schema":{}}}},"400":{"description":"A specific domain error occurred (see list below):\n* **`NO_PASSWORD_PROVIDER`:** The user needs to set a password in to perform this action.\n* **`NO_PASSWORD_PROVIDER`:** The user needs to set a password in to perform this action.","content":{"application/json":{"schema":{}}}},"401":{"description":"A specific domain error occurred (see list below):\n* **`ACCESS_TOKEN_EXPIRED`:** Indicates that the access token is expired.\n* **`ACCESS_TOKEN_INVALID`:** Indicates that the access token cannot be decoded.\n* **`STEP_UP_TOKEN_EXPIRED`:** Indicates that the step-up token is expired.\n* **`STEP_UP_TOKEN_INVALID`:** Indicates that the step-up token cannot be decoded.\n* **`STEP_UP_TOKEN_MISSING`:** Thrown when the step-up token is missing.\n* **`TOTP_SETUP_TOKEN_EXPIRED`:** Indicates that the TOTP setup token is expired.\n* **`TOTP_SETUP_TOKEN_INVALID`:** Indicates that the TOTP setup token cannot be decoded.\n* **`TOTP_SETUP_TOKEN_MISSING`:** Thrown when the TOTP setup token is missing.\n* **`WRONG_TWO_FACTOR_CODE`:** Wrong two-factor code.\n* **`ACCESS_TOKEN_EXPIRED`:** Indicates that the access token is expired.\n* **`ACCESS_TOKEN_INVALID`:** Indicates that the access token cannot be decoded.\n* **`STEP_UP_TOKEN_EXPIRED`:** Indicates that the step-up token is expired.\n* **`STEP_UP_TOKEN_INVALID`:** Indicates that the step-up token cannot be decoded.\n* **`STEP_UP_TOKEN_MISSING`:** Thrown when the step-up token is missing.\n* **`TOTP_SETUP_TOKEN_EXPIRED`:** Indicates that the TOTP setup token is expired.\n* **`TOTP_SETUP_TOKEN_INVALID`:** Indicates that the TOTP setup token cannot be decoded.\n* **`TOTP_SETUP_TOKEN_MISSING`:** Thrown when the TOTP setup token is missing.\n* **`WRONG_TWO_FACTOR_CODE`:** Wrong two-factor code.","content":{"application/json":{"schema":{}}}},"404":{"description":"A specific domain error occurred (see list below):\n* **`USER_NOT_FOUND`:** User not found.\n* **`USER_NOT_FOUND`:** User not found.","content":{"application/json":{"schema":{}}}},"500":{"description":"A specific domain error occurred (see list below):\n* **`ACCESS_TOKEN_ALLOWLIST_READING_FAILURE`:** Represents an exception indicating a failure when reading the allowlist for an access token cache.\n* **`DATABASE_FAILURE`:** Exception representing a general failure related to database operations.\n* **`DATABASE_ENCRYPTION_FAILURE`:** Exception representing a general failure related to database encryption operations.\n* **`DATABASE_FAILURE`:** Exception representing a general failure related to database operations.\n* **`HASH_FAILURE`:** Exception representing a general failure related to hashing operations.\n* **`INVALID_USER_DOCUMENT`:** A requested user document was stored in an invalid format.\n* **`TOTP_FAILURE`:** TOTP code validation failed.\n* **`INVALID_PRINCIPAL_DOCUMENT`:** A requested principal document was stored in an invalid format.\n* **`ACCESS_TOKEN_ALLOWLIST_READING_FAILURE`:** Represents an exception indicating a failure when reading the allowlist for an access token cache.\n* **`DATABASE_FAILURE`:** Exception representing a general failure related to database operations.\n* **`DATABASE_ENCRYPTION_FAILURE`:** Exception representing a general failure related to database encryption operations.\n* **`DATABASE_FAILURE`:** Exception representing a general failure related to database operations.\n* **`HASH_FAILURE`:** Exception representing a general failure related to hashing operations.\n* **`INVALID_USER_DOCUMENT`:** A requested user document was stored in an invalid format.\n* **`TOTP_FAILURE`:** TOTP code validation failed.\n* **`INVALID_PRINCIPAL_DOCUMENT`:** A requested principal document was stored in an invalid format.","content":{"application/json":{"schema":{}}}}}}
>
  
</StatusCodes>


      