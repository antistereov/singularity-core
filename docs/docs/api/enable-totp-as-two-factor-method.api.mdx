---
id: enable-totp-as-two-factor-method
title: "Enable TOTP as 2FA Method"
description: "Complete the TOTP setup `token` from [`GET /api/auth/2fa/setup`](../../docs/api/get-totp-setup-details)"
sidebar_label: "Enable TOTP as 2FA Method"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/singularity-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Enable TOTP as 2FA Method"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/auth/2fa/totp/setup"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Complete the TOTP setup `token` from [`GET /api/auth/2fa/setup`](../../docs/api/get-totp-setup-details) 
and a TOTP code from an authenticator app.

You can learn more about this [here](../../docs/guides/auth/two-factor#setup).

A [security alert](../../docs/guides/auth/security-alerts#2fa-specific-alerts)
will be sent to the user's email if this setting is enabled and
email is [enabled and configured correctly](../../docs/guides/email/configuration).

### Requirements
- The user can authenticate using password. 2FA will not work with OAuth2. 
  The OAuth2 provider will validate the second factor if the user enabled it for the provider.
  
### Locale

A locale can be specified for this request. 
The email will be sent in the specified locale.
You can learn more about locale in emails [here](../../docs/guides/email/templates).

If no locale is specified, the applications default locale will be used.
You can learn more about configuring the default locale [here](../../docs/guides/configuration).

### Tokens
- A valid [`AccessToken`](../../docs/guides/auth/tokens#access-token) is required.
- A valid [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  is required. This token should match user and session contained in the `AccessToken`.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={[{"name":"locale","in":"query","required":false,"schema":{"type":"string"}}]}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string"},"code":{"type":"integer","format":"int32"}},"required":["code","token"],"title":"TwoFactorVerifySetupRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Success.","content":{"*/*":{"schema":{"type":"object","properties":{"secret":{"type":"string"},"totpAuthUrl":{"type":"string"},"recoveryCodes":{"type":"array","items":{"type":"string"}},"token":{"type":"string"}},"required":["recoveryCodes","secret","token","totpAuthUrl"],"title":"TwoFactorSetupResponse"}}}},"207":{"description":"The following error codes correspond to this status:\n* **`POST_COMMIT_SIDE_EFFECT_FAILURE`:** Exception representing a failure to perform a side effect after a successful database operation.\n* **`USER_AVATAR_MAPPING_FAILURE`:** Failed to map avatar metadata.","content":{"application/json":{"schema":{}}}},"304":{"description":"The following error codes correspond to this status:\n* **`TWO_FACTOR_METHOD_ALREADY_ENABLED`:** Two-factor authentication method is already enabled.","content":{"application/json":{"schema":{}}}},"400":{"description":"The following error codes correspond to this status:\n* **`NO_PASSWORD_PROVIDER`:** The user needs to set a password in to perform this action.","content":{"application/json":{"schema":{}}}},"401":{"description":"The following error codes correspond to this status:\n* **`ACCESS_TOKEN_EXPIRED`:** Indicates that the access token is expired.\n* **`ACCESS_TOKEN_INVALID`:** Indicates that the access token cannot be decoded.\n* **`STEP_UP_TOKEN_EXPIRED`:** Indicates that the step-up token is expired.\n* **`STEP_UP_TOKEN_INVALID`:** Indicates that the step-up token cannot be decoded.\n* **`STEP_UP_TOKEN_MISSING`:** Thrown when the step-up token is missing.\n* **`TOTP_SETUP_TOKEN_EXPIRED`:** Indicates that the TOTP setup token is expired.\n* **`TOTP_SETUP_TOKEN_INVALID`:** Indicates that the TOTP setup token cannot be decoded.\n* **`TOTP_SETUP_TOKEN_MISSING`:** Thrown when the TOTP setup token is missing.\n* **`WRONG_TWO_FACTOR_CODE`:** Wrong two-factor code.","content":{"application/json":{"schema":{}}}},"404":{"description":"The following error codes correspond to this status:\n* **`USER_NOT_FOUND`:** User not found.","content":{"application/json":{"schema":{}}}},"500":{"description":"The following error codes correspond to this status:\n* **`ACCESS_TOKEN_ALLOWLIST_READING_FAILURE`:** Represents an exception indicating a failure when reading the allowlist for an access token cache.\n* **`DATABASE_FAILURE`:** Exception representing a general failure related to database operations.\n* **`DATABASE_ENCRYPTION_FAILURE`:** Exception representing a general failure related to database encryption operations.\n* **`HASH_FAILURE`:** Exception representing a general failure related to hashing operations.\n* **`INVALID_USER_DOCUMENT`:** A requested user document was stored in an invalid format.\n* **`TOTP_FAILURE`:** TOTP code validation failed.\n* **`INVALID_PRINCIPAL_DOCUMENT`:** A requested principal document was stored in an invalid format.","content":{"application/json":{"schema":{}}}}}}
>
  
</StatusCodes>


      