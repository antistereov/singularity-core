---
id: enable-totp-as-two-factor-method
title: "Enable TOTP as 2FA Method"
description: "Complete the TOTP setup `token` from [`GET /api/auth/2fa/setup`](../../docs/api/get-totp-setup-details)"
sidebar_label: "Enable TOTP as 2FA Method"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/singularity-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Enable TOTP as 2FA Method"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/auth/2fa/totp/setup"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Complete the TOTP setup `token` from [`GET /api/auth/2fa/setup`](../../docs/api/get-totp-setup-details) 
and a TOTP code from an authenticator app.

You can learn more about this [here](../../docs/guides/auth/two-factor#setup).

A [security alert](../../docs/guides/auth/security-alerts#2fa-specific-alerts)
will be sent to the user's email if this setting is enabled and
email is [enabled and configured correctly](../../docs/guides/email/configuration).

### Requirements
- The user can authenticate using password. 2FA will not work with OAuth2. 
  The OAuth2 provider will validate the second factor if the user enabled it for the provider.
  
### Locale

A locale can be specified for this request. 
The email will be sent in the specified locale.
You can learn more about locale in emails [here](../../docs/guides/email/templates).

If no locale is specified, the applications default locale will be used.
You can learn more about configuring the default locale [here](../../docs/guides/configuration).

### Tokens
- A valid [`AccessToken`](../../docs/guides/auth/tokens#access-token) is required.
- A valid [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  is required. This token should match user and session contained in the `AccessToken`.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={[{"name":"locale","in":"query","required":false,"schema":{"type":"string"}}]}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"token":{"type":"string"},"code":{"type":"integer","format":"int32"}},"required":["code","token"],"title":"TwoFactorVerifySetupRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Success.","content":{"*/*":{"schema":{"type":"object","properties":{"secret":{"type":"string"},"totpAuthUrl":{"type":"string"},"recoveryCodes":{"type":"array","items":{"type":"string"}},"token":{"type":"string"}},"required":["recoveryCodes","secret","token","totpAuthUrl"],"title":"TwoFactorSetupResponse"}}}},"207":{"description":"The following error codes correspond to this status:\n* **`POST_COMMIT_SIDE_EFFECT_FAILURE`:** Exception representing a failure to perform a side effect after a successful database operation.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"304":{"description":"The following error codes correspond to this status:\n* **`TWO_FACTOR_METHOD_ALREADY_ENABLED`:** Two-factor authentication method is already enabled.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"400":{"description":"The following error codes correspond to this status:\n* **`NO_PASSWORD_PROVIDER`:** The user needs to set a password in to perform this action.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"401":{"description":"The following error codes correspond to this status:\n* **`ACCESS_TOKEN_EXPIRED`:** Indicates that the access token is expired.\n* **`ACCESS_TOKEN_INVALID`:** Indicates that the access token cannot be decoded.\n* **`AUTHENTICATION_REQUIRED`:** User is not authenticated.\n* **`STEP_UP_TOKEN_EXPIRED`:** Indicates that the step-up token is expired.\n* **`STEP_UP_TOKEN_INVALID`:** Indicates that the step-up token cannot be decoded.\n* **`STEP_UP_TOKEN_MISSING`:** Thrown when the step-up token is missing.\n* **`TOTP_SETUP_TOKEN_EXPIRED`:** Indicates that the TOTP setup token is expired.\n* **`TOTP_SETUP_TOKEN_INVALID`:** Indicates that the TOTP setup token cannot be decoded.\n* **`TOTP_SETUP_TOKEN_MISSING`:** Thrown when the TOTP setup token is missing.\n* **`WRONG_TWO_FACTOR_CODE`:** Wrong two-factor code.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"404":{"description":"The following error codes correspond to this status:\n* **`USER_NOT_FOUND`:** User not found.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"500":{"description":"The following error codes correspond to this status:\n* **`ACCESS_TOKEN_ALLOWLIST_READING_FAILURE`:** Represents an exception indicating a failure when reading the allowlist for an access token cache.\n* **`DATABASE_FAILURE`:** Exception representing a general failure related to database operations.\n* **`DATABASE_ENCRYPTION_FAILURE`:** Exception representing a general failure related to database encryption operations.\n* **`HASH_FAILURE`:** Exception representing a general failure related to hashing operations.\n* **`INVALID_USER_DOCUMENT`:** A requested user document was stored in an invalid format.\n* **`TOTP_FAILURE`:** TOTP code validation failed.\n* **`INVALID_PRINCIPAL_DOCUMENT`:** A requested principal document was stored in an invalid format.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}}}}
>
  
</StatusCodes>


      