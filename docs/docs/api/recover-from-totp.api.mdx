---
id: recover-from-totp
title: "Recover From TOTP"
description: "Recover the user if they lost access to their 2FA device using a recovery `code`."
sidebar_label: "Recover From TOTP"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/singularity-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Recover From TOTP"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/auth/2fa/totp/recover"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Recover the user if they lost access to their 2FA device using a recovery `code`.
Each `code` is only valid once.

You can learn more about recovery for TOTP [here](../../docs/guides/auth/two-factor#recovery).

### Requirements
- The user can authenticate using password.
- The user enabled TOTP as 2FA method.

**Optional session data:**
- The `session` object can be included in the request body.
- Inside the `session` object, you can provide the following optional fields:
    - `browser`: The name of the browser used (e.g., "Chrome", "Firefox").
    - `os`: The operating system of the device (e.g., "Windows", "macOS", "Android").

### Tokens
- A valid [`TwoFactorAuthenticationToken`](../../docs/guides/auth/tokens#two-factor-authentication-token)
  is required. This token will be set automatically as HTTP-only cookie through 
  [`POST /api/auth/login`](../../docs/api/login) or
  [`POST /api/auth/step-up`](../../docs/api/step-up)
  or can be retrieved from any of those endpoints' response and set as header manually if [header authentication](../../docs/guides/auth/authentication#header-authentication) 
  is enabled.
- If this action is successful, [`AccessToken`](../../docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](../../docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  will automatically be set as HTTP-only cookies.
  
  If [header authentication](../../docs/guides/auth/authentication#header-authentication) is enabled,
  [`AccessToken`](../../docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](../../docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  will be returned in the response body and can be used in the authorization header for upcoming requests.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={undefined}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"string"},"session":{"type":"object","properties":{"browser":{"type":"string","description":"The name of the browser used.","example":"Chrome"},"os":{"type":"string","description":"The operating system of the device.","example":"WIndows"}},"title":"SessionInfoRequest"}},"required":["code"],"title":"TotpRecoveryRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Recovery successful. If header authentication is enabled, the response will contain all tokens.","content":{"*/*":{"schema":{"type":"object","properties":{"user":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"name":{"type":"string"},"email":{"type":"string"},"identityProviders":{"type":"array","items":{"type":"string"}},"roles":{"type":"array","items":{"type":"string","enum":["USER","ADMIN","GUEST"]},"uniqueItems":true},"emailVerified":{"type":"boolean"},"lastActive":{"type":"string"},"twoFactorAuthEnabled":{"type":"boolean"},"preferredTwoFactorMethod":{"type":"string","enum":["totp","mail"]},"twoFactorMethods":{"type":"array","items":{"type":"string","enum":["totp","mail"]}},"avatar":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"key":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"},"access":{"type":"object","properties":{"ownerId":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"visibility":{"type":"string","enum":["PRIVATE","PUBLIC","SHARED"]},"canEdit":{"type":"boolean"},"canDelete":{"type":"boolean"}},"required":["canDelete","canEdit","ownerId","visibility"],"title":"ContentAccessDetailsResponse"},"renditions":{"type":"object","additionalProperties":{"type":"object","properties":{"key":{"type":"string"},"size":{"type":"integer","format":"int64"},"contentType":{"type":"string"},"url":{"type":"string"},"width":{"type":"integer","format":"int32"},"height":{"type":"integer","format":"int32"}},"required":["contentType","key","size","url"],"title":"FileRenditionResponse"}}},"required":["access","createdAt","id","key","renditions","updatedAt"],"title":"FileMetadataResponse"},"createdAt":{"type":"string"},"groups":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["createdAt","emailVerified","groups","id","identityProviders","lastActive","name","roles","twoFactorAuthEnabled","twoFactorMethods"],"title":"UserResponse"},"accessToken":{"type":"string"},"refreshToken":{"type":"string"},"stepUpToken":{"type":"string"},"sessionToken":{"type":"string"}},"required":["user"],"title":"TwoFactorRecoveryResponse"}}}},"400":{"description":"TOTP is disabled.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}},"401":{"description":"Wrong code or invalid or expired `TwoFactorAuthenticationToken`.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}}}}
>
  
</StatusCodes>


      