---
id: recover-from-totp
title: "Recover From TOTP"
description: "Recover the user if they lost access to their 2FA device using a recovery `code`."
sidebar_label: "Recover From TOTP"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/singularity-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Recover From TOTP"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/auth/2fa/totp/recover"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Recover the user if they lost access to their 2FA device using a recovery `code`.
Each `code` is only valid once.

You can learn more about recovery for TOTP [here](https://singularity.stereov.io/docs/guides/auth/two-factor#recovery).

### Requirements
- The user can authenticate using password.
- The user enabled TOTP as 2FA method.

**Optional session data:**
- The `session` object can be included in the request body.
- Inside the `session` object, you can provide the following optional fields:
    - `browser`: The name of the browser used (e.g., "Chrome", "Firefox").
    - `os`: The operating system of the device (e.g., "Windows", "macOS", "Android").

### Tokens
- A valid [`TwoFactorAuthenticationToken`](https://singularity.stereov.io/docs/guides/auth/tokens#two-factor-authentication-token)
  is required. This token will be set automatically as HTTP-only cookie through 
  [`POST /api/auth/login`](https://singularity.stereov.io/docs/api/login) or
  [`POST /api/auth/step-up`](https://singularity.stereov.io/docs/api/step-up)
  or can be retrieved from any of those endpoints' response and set as header manually if [header authentication](https://singularity.stereov.io/docs/guides/authentication#header-authentication) 
  is enabled.
- If this action is successful, [`AccessToken`](https://singularity.stereov.io/docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](https://singularity.stereov.io/docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](https://singularity.stereov.io/docs/guides/auth/tokens#step-up-token)
  will automatically be set as HTTP-only cookies.
  
  If [header authentication](https://singularity.stereov.io/docs/guides/auth/authentication#header-authentication) is enabled,
  [`AccessToken`](https://singularity.stereov.io/docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](https://singularity.stereov.io/docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](https://singularity.stereov.io/docs/guides/auth/tokens#step-up-token)
  will be returned in the response body and can be used in the authorization header for upcoming requests.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={undefined}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"string"},"session":{"type":"object","properties":{"browser":{"type":"string","description":"The name of the browser used.","example":"Chrome"},"os":{"type":"string","description":"The operating system of the device.","example":"WIndows"}},"title":"SessionInfoRequest"}},"required":["code"],"title":"TotpRecoveryRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Recovery successful. If header authentication is enabled, the response will contain all tokens.","content":{"*/*":{"schema":{"type":"object","properties":{"user":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"name":{"type":"string"},"email":{"type":"string"},"identityProviders":{"type":"array","items":{"type":"string"}},"roles":{"type":"array","items":{"type":"string","enum":["USER","ADMIN","GUEST"]},"uniqueItems":true},"emailVerified":{"type":"boolean"},"lastActive":{"type":"string"},"twoFactorAuthEnabled":{"type":"boolean"},"preferredTwoFactorMethod":{"type":"string","enum":["totp","mail"]},"twoFactorMethods":{"type":"array","items":{"type":"string","enum":["totp","mail"]}},"avatar":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"key":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"},"access":{"type":"object","properties":{"ownerId":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"visibility":{"type":"string","enum":["PRIVATE","PUBLIC","SHARED"]},"users":{"type":"object","properties":{"maintainer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"editor":{"type":"array","items":{"type":"string"},"uniqueItems":true},"viewer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"isEmpty":{"type":"boolean"}},"required":["editor","isEmpty","maintainer","viewer"],"title":"ContentAccessPermissions"},"groups":{"type":"object","properties":{"maintainer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"editor":{"type":"array","items":{"type":"string"},"uniqueItems":true},"viewer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"isEmpty":{"type":"boolean"}},"required":["editor","isEmpty","maintainer","viewer"],"title":"ContentAccessPermissions"},"invitations":{"type":"array","items":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"uniqueItems":true}},"required":["groups","invitations","ownerId","users","visibility"],"title":"ContentAccessDetails"},"renditions":{"type":"object","additionalProperties":{"type":"object","properties":{"key":{"type":"string"},"size":{"type":"integer","format":"int64"},"contentType":{"type":"string"},"url":{"type":"string"},"width":{"type":"integer","format":"int32"},"height":{"type":"integer","format":"int32"}},"required":["contentType","key","size","url"],"title":"FileRenditionResponse"}},"trusted":{"type":"boolean"},"tags":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["access","createdAt","id","key","renditions","tags","trusted","updatedAt"],"title":"FileMetadataResponse"},"created":{"type":"string"},"groups":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["created","emailVerified","groups","id","identityProviders","lastActive","name","roles","twoFactorAuthEnabled","twoFactorMethods"],"title":"UserResponse"},"accessToken":{"type":"string"},"refreshToken":{"type":"string"},"stepUpToken":{"type":"string"},"sessionToken":{"type":"string"}},"required":["user"],"title":"TwoFactorRecoveryResponse"}}}},"400":{"description":"TOTP is disabled.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}},"401":{"description":"Wrong code or invalid or expired `TwoFactorAuthenticationToken`.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}}}}
>
  
</StatusCodes>


      