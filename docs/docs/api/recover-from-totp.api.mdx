---
id: recover-from-totp
title: "Recover From TOTP"
description: "Recover the user if they lost access to their 2FA device."
sidebar_label: "Recover From TOTP"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/singularity-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Recover From TOTP"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/auth/2fa/totp/recover"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Recover the user if they lost access to their 2FA device.

You can learn more about recovery for TOTP [here](https://singularity.stereov.io/docs/guides/auth/two-factor#recovery).

**Requirements:**
- The user can authenticate using password.
- The user enabled TOTP as 2FA method.

**Tokens:**
- A valid [`TwoFactorAuthenticationToken`](https://singularity.stereov.io/docs/guides/auth/tokens#two-factor-authentication-token)
  is required. This token will be set automatically as HTTP-only cookie through 
  [`POST /api/auth/login`](https://singularity.stereov.io/docs/api/login) or
  [`POST /api/auth/step-up`](https://singularity.stereov.io/docs/api/step-up)
  or can be retrieved from any of those endpoints' response and set as header manually if [header authentication](https://singularity.stereov.io/docs/guides/authentication#header-authentication) 
  is enabled.
- If this action is successful, [`AccessToken`](https://singularity.stereov.io/docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](https://singularity.stereov.io/docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](https://singularity.stereov.io/docs/guides/auth/tokens#step-up-token)
  will automatically be set as HTTP-only cookies.
  
  If [header authentication](https://singularity.stereov.io/docs/guides/auth/authentication#header-authentication) is enabled,
  [`AccessToken`](https://singularity.stereov.io/docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](https://singularity.stereov.io/docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](https://singularity.stereov.io/docs/guides/auth/tokens#step-up-token)
  will be returned in the response body and can be used in the authorization header for upcoming requests.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={[{"name":"code","in":"query","required":true,"schema":{"type":"string"}}]}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"browser":{"type":"string","description":"The name of the browser used.","example":"Chrome"},"os":{"type":"string","description":"The operating system of the device.","example":"WIndows"}},"title":"SessionInfoRequest"}}}}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Recovery successful. If header authentication is enabled, the response will contain all tokens.","content":{"*/*":{"schema":{"type":"object","properties":{"user":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"name":{"type":"string"},"email":{"type":"string"},"identityProviders":{"type":"array","items":{"type":"string"}},"roles":{"type":"array","items":{"type":"string","enum":["USER","ADMIN","GUEST"]},"uniqueItems":true},"emailVerified":{"type":"boolean"},"lastActive":{"type":"string"},"twoFactorAuthEnabled":{"type":"boolean"},"preferredTwoFactorMethod":{"type":"string","enum":["totp","mail"]},"twoFactorAuthMethods":{"type":"array","items":{"type":"string","enum":["totp","mail"]}},"avatar":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"key":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"},"access":{"type":"object","properties":{"ownerId":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"visibility":{"type":"string","enum":["PRIVATE","PUBLIC","SHARED"]},"users":{"type":"object","properties":{"admin":{"type":"array","items":{"type":"string"},"uniqueItems":true},"editor":{"type":"array","items":{"type":"string"},"uniqueItems":true},"viewer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"isEmpty":{"type":"boolean"}},"required":["admin","editor","isEmpty","viewer"],"title":"ContentAccessPermissions"},"groups":{"type":"object","properties":{"admin":{"type":"array","items":{"type":"string"},"uniqueItems":true},"editor":{"type":"array","items":{"type":"string"},"uniqueItems":true},"viewer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"isEmpty":{"type":"boolean"}},"required":["admin","editor","isEmpty","viewer"],"title":"ContentAccessPermissions"},"invitations":{"type":"array","items":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"uniqueItems":true}},"required":["groups","invitations","ownerId","users","visibility"],"title":"ContentAccessDetails"},"contentType":{"type":"string"},"url":{"type":"string"},"size":{"type":"integer","format":"int64"},"trusted":{"type":"boolean"},"tags":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["access","contentType","createdAt","id","key","size","tags","trusted","updatedAt","url"],"title":"FileMetadataResponse"},"created":{"type":"string"},"groups":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["created","emailVerified","groups","id","identityProviders","lastActive","name","roles","twoFactorAuthEnabled","twoFactorAuthMethods"],"title":"UserResponse"},"accessToken":{"type":"string"},"refreshToken":{"type":"string"},"stepUpToken":{"type":"string"},"sessionToken":{"type":"string"}},"required":["user"],"title":"TwoFactorRecoveryResponse"}}}},"304":{"description":"User is already authenticated.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}},"401":{"description":"Wrong code or invalid or expired `TwoFactorAuthenticationToken`.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}}}}
>
  
</StatusCodes>


      