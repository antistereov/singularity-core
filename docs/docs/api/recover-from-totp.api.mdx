---
id: recover-from-totp
title: "Recover From TOTP"
description: "Recover the user if they lost access to their 2FA device using a recovery `code`."
sidebar_label: "Recover From TOTP"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/singularity-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Recover From TOTP"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/auth/2fa/totp/recover"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Recover the user if they lost access to their 2FA device using a recovery `code`.
Each `code` is only valid once.

You can learn more about recovery for TOTP [here](https://singularity.stereov.io/docs/guides/auth/two-factor#recovery).

### Requirements
- The user can authenticate using password.
- The user enabled TOTP as 2FA method.

**Optional session data:**
- The `session` object can be included in the request body.
- Inside the `session` object, you can provide the following optional fields:
    - `browser`: The name of the browser used (e.g., "Chrome", "Firefox").
    - `os`: The operating system of the device (e.g., "Windows", "macOS", "Android").

### Tokens
- A valid [`TwoFactorAuthenticationToken`](https://singularity.stereov.io/docs/guides/auth/tokens#two-factor-authentication-token)
  is required. This token will be set automatically as HTTP-only cookie through 
  [`POST /api/auth/login`](https://singularity.stereov.io/docs/api/login) or
  [`POST /api/auth/step-up`](https://singularity.stereov.io/docs/api/step-up)
  or can be retrieved from any of those endpoints' response and set as header manually if [header authentication](https://singularity.stereov.io/docs/guides/authentication#header-authentication) 
  is enabled.
- If this action is successful, [`AccessToken`](https://singularity.stereov.io/docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](https://singularity.stereov.io/docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](https://singularity.stereov.io/docs/guides/auth/tokens#step-up-token)
  will automatically be set as HTTP-only cookies.
  
  If [header authentication](https://singularity.stereov.io/docs/guides/auth/authentication#header-authentication) is enabled,
  [`AccessToken`](https://singularity.stereov.io/docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](https://singularity.stereov.io/docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](https://singularity.stereov.io/docs/guides/auth/tokens#step-up-token)
  will be returned in the response body and can be used in the authorization header for upcoming requests.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={undefined}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"string"},"session":{"type":"object","properties":{"browser":{"type":"string","description":"The name of the browser used.","example":"Chrome"},"os":{"type":"string","description":"The operating system of the device.","example":"WIndows"}},"title":"SessionInfoRequest"}},"required":["code"],"title":"TotpRecoveryRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Recovery successful. If header authentication is enabled, the response will contain all tokens.","content":{"*/*":{"schema":{"type":"object","properties":{"user":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"name":{"type":"string"},"email":{"type":"string"},"identityProviders":{"type":"array","items":{"type":"string"}},"roles":{"type":"array","items":{"type":"string","enum":["USER","ADMIN","GUEST"]},"uniqueItems":true},"emailVerified":{"type":"boolean"},"lastActive":{"type":"string"},"twoFactorAuthEnabled":{"type":"boolean"},"preferredTwoFactorMethod":{"type":"string","enum":["totp","mail"]},"twoFactorMethods":{"type":"array","items":{"type":"string","enum":["totp","mail"]}},"avatar":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"key":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"},"access":{"type":"object","properties":{"ownerId":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"visibility":{"type":"string","enum":["PRIVATE","PUBLIC","SHARED"]},"users":{"type":"object","properties":{"maintainer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"editor":{"type":"array","items":{"type":"string"},"uniqueItems":true},"viewer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"isEmpty":{"type":"boolean"}},"required":["editor","isEmpty","maintainer","viewer"],"title":"ContentAccessPermissions"},"groups":{"type":"object","properties":{"maintainer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"editor":{"type":"array","items":{"type":"string"},"uniqueItems":true},"viewer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"isEmpty":{"type":"boolean"}},"required":["editor","isEmpty","maintainer","viewer"],"title":"ContentAccessPermissions"},"invitations":{"type":"array","items":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"uniqueItems":true}},"required":["groups","invitations","ownerId","users","visibility"],"title":"ContentAccessDetails"},"renditions":{"type":"object","additionalProperties":{"type":"object","properties":{"key":{"type":"string"},"size":{"type":"integer","format":"int64"},"contentType":{"type":"string"},"url":{"type":"string"},"width":{"type":"integer","format":"int32"},"height":{"type":"integer","format":"int32"}},"required":["contentType","key","size","url"],"title":"FileRenditionResponse"}},"trusted":{"type":"boolean"},"tags":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["access","createdAt","id","key","renditions","tags","trusted","updatedAt"],"title":"FileMetadataResponse"},"created":{"type":"string"},"groups":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["created","emailVerified","groups","id","identityProviders","lastActive","name","roles","twoFactorAuthEnabled","twoFactorMethods"],"title":"UserResponse"},"accessToken":{"type":"string"},"refreshToken":{"type":"string"},"stepUpToken":{"type":"string"},"sessionToken":{"type":"string"}},"required":["user"],"title":"TwoFactorRecoveryResponse"}}}},"400":{"description":"TOTP is disabled.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}},"401":{"description":"Wrong code or invalid or expired `TwoFactorAuthenticationToken`.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}}}}
>
  
</StatusCodes>


      