---
id: recover-from-totp
title: "Recover From TOTP"
description: "Recover the user if they lost access to their 2FA device using a recovery `code`."
sidebar_label: "Recover From TOTP"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/singularity-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Recover From TOTP"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/auth/2fa/totp/recover"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Recover the user if they lost access to their 2FA device using a recovery `code`.
Each `code` is only valid once.

You can learn more about recovery for TOTP [here](../../docs/guides/auth/two-factor#recovery).

### Requirements
- The user can authenticate using password.
- The user enabled TOTP as 2FA method.

**Optional session data:**
- The `session` object can be included in the request body.
- Inside the `session` object, you can provide the following optional fields:
    - `browser`: The name of the browser used (e.g., "Chrome", "Firefox").
    - `os`: The operating system of the device (e.g., "Windows", "macOS", "Android").

### Tokens
- A valid [`TwoFactorAuthenticationToken`](../../docs/guides/auth/tokens#two-factor-authentication-token)
  is required. This token will be set automatically as HTTP-only cookie through 
  [`POST /api/auth/login`](../../docs/api/login) or
  [`POST /api/auth/step-up`](../../docs/api/step-up)
  or can be retrieved from any of those endpoints' response and set as header manually if [header authentication](../../docs/guides/auth/authentication#header-authentication) 
  is enabled.
- If this action is successful, [`AccessToken`](../../docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](../../docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  will automatically be set as HTTP-only cookies.
  
  If [header authentication](../../docs/guides/auth/authentication#header-authentication) is enabled,
  [`AccessToken`](../../docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](../../docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  will be returned in the response body and can be used in the authorization header for upcoming requests.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={undefined}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"string"},"session":{"type":"object","properties":{"browser":{"type":"string","description":"The name of the browser used.","example":"Chrome"},"os":{"type":"string","description":"The operating system of the device.","example":"WIndows"}},"title":"SessionInfoRequest"}},"required":["code"],"title":"TotpRecoveryRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Recovery successful. If header authentication is enabled, the response will contain all tokens.","content":{"*/*":{"schema":{"type":"object","properties":{"user":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"name":{"type":"string"},"email":{"type":"string"},"identityProviders":{"type":"array","items":{"type":"string"}},"roles":{"type":"array","items":{"oneOf":[{"allOf":[{"type":"object","properties":{"value":{"type":"string"},"logger":{"type":"object","properties":{"isInfoEnabled":{"type":"boolean","deprecated":true,"description":"Use isInfoEnabled() instead"},"isDebugEnabled":{"type":"boolean","deprecated":true,"description":"Use isDebugEnabled() instead"},"isErrorEnabled":{"type":"boolean","deprecated":true,"description":"Use isErrorEnabled() instead"},"isTraceEnabled":{"type":"boolean","deprecated":true,"description":"Use isTraceEnabled() instead"},"isWarnEnabled":{"type":"boolean","deprecated":true,"description":"Use isWarnEnabled() instead"},"isLoggingOff":{"type":"boolean","deprecated":true,"description":"Use isLoggingOff() instead"},"name":{"type":"string"}},"required":["isDebugEnabled","isErrorEnabled","isInfoEnabled","isLoggingOff","isTraceEnabled","isWarnEnabled","name"],"title":"KLogger"}},"required":["logger","value"],"title":"Role"}],"enum":["GUEST"],"title":"Guest"},{"allOf":[{"type":"object","properties":{"value":{"type":"string"},"logger":{"type":"object","properties":{"isInfoEnabled":{"type":"boolean","deprecated":true,"description":"Use isInfoEnabled() instead"},"isDebugEnabled":{"type":"boolean","deprecated":true,"description":"Use isDebugEnabled() instead"},"isErrorEnabled":{"type":"boolean","deprecated":true,"description":"Use isErrorEnabled() instead"},"isTraceEnabled":{"type":"boolean","deprecated":true,"description":"Use isTraceEnabled() instead"},"isWarnEnabled":{"type":"boolean","deprecated":true,"description":"Use isWarnEnabled() instead"},"isLoggingOff":{"type":"boolean","deprecated":true,"description":"Use isLoggingOff() instead"},"name":{"type":"string"}},"required":["isDebugEnabled","isErrorEnabled","isInfoEnabled","isLoggingOff","isTraceEnabled","isWarnEnabled","name"],"title":"KLogger"}},"required":["logger","value"],"title":"Role"}],"enum":["USER","ADMIN"],"title":"User"}]},"uniqueItems":true},"emailVerified":{"type":"boolean"},"lastActive":{"type":"string"},"twoFactorAuthEnabled":{"type":"boolean"},"preferredTwoFactorMethod":{"type":"string","enum":["totp","email"]},"twoFactorMethods":{"type":"array","items":{"type":"string","enum":["totp","email"]}},"avatar":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"key":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"},"access":{"type":"object","properties":{"ownerId":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"visibility":{"type":"string","enum":["PRIVATE","PUBLIC","SHARED"]},"canEdit":{"type":"boolean"},"canDelete":{"type":"boolean"}},"required":["canDelete","canEdit","ownerId","visibility"],"title":"ContentAccessDetailsResponse"},"renditions":{"type":"object","additionalProperties":{"type":"object","properties":{"key":{"type":"string"},"size":{"type":"integer","format":"int64"},"contentType":{"type":"string"},"url":{"type":"string"},"width":{"type":"integer","format":"int32"},"height":{"type":"integer","format":"int32"}},"required":["contentType","key","size","url"],"title":"FileRenditionResponse"}},"originalUrl":{"type":"string"}},"required":["access","createdAt","id","key","renditions","updatedAt"],"title":"FileMetadataResponse"},"createdAt":{"type":"string"},"groups":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["createdAt","emailVerified","groups","id","identityProviders","lastActive","name","roles","twoFactorAuthEnabled","twoFactorMethods"],"title":"UserResponse"},"accessToken":{"type":"string"},"refreshToken":{"type":"string"},"stepUpToken":{"type":"string"}},"required":["user"],"title":"TwoFactorRecoveryResponse"}}}},"400":{"description":"The following error codes correspond to this status:\n* **`TWO_FACTOR_METHOD_DISABLED`:** Two-factor authentication method is disabled.\n* **`NO_PASSWORD_PROVIDER`:** The user needs to set a password in to perform this action.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"401":{"description":"The following error codes correspond to this status:\n* **`TWO_FACTOR_AUTHENTICATION_TOKEN_EXPIRED`:** Indicates that the two-factor authentication token is expired.\n* **`TWO_FACTOR_AUTHENTICATION_TOKEN_INVALID`:** Indicates that the two-factor authentication token cannot be decoded.\n* **`TWO_FACTOR_AUTHENTICATION_TOKEN_MISSING`:** Thrown when the two-factor authentication token is missing.\n* **`WRONG_TOTP_RECOVERY_CODE`:** The given recovery code is not correct.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"403":{"description":"The following error codes correspond to this status:\n* **`STEP_UP_TOKEN_CREATION_FORBIDDEN`:** Thrown when a step-up token is requested from an illegal context.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"404":{"description":"The following error codes correspond to this status:\n* **`USER_NOT_FOUND`:** User not found.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}},"500":{"description":"The following error codes correspond to this status:\n* **`DATABASE_FAILURE`:** Exception representing a general failure related to database operations.\n* **`HASH_FAILURE`:** Exception representing a general failure related to hashing operations.\n* **`INVALID_USER_DOCUMENT`:** A requested user document was stored in an invalid format.\n* **`POST_COMMIT_SIDE_EFFECT_FAILURE`:** Exception representing a failure to perform a side effect after a successful database operation.\n* **`COOKIE_CREATION_FAILURE`:** Thrown when an exception occurred during the creation of a cookie.\n* **`ACCESS_TOKEN_CACHE_FAILURE`:** Thrown when an access token could not be created due to an exception in the access token whitelist.\n* **`ACCESS_TOKEN_ENCODING_FAILURE`:** Represents an exception that occurs during the encoding process of an access token.\n* **`ACCESS_TOKEN_CREATION_FAILURE`:** Thrown when a generic exception occurred during the creation of an access token.\n* **`ACCESS_TOKEN_INVALID_PRINCIPAL_DOCUMENT_FAILURE`:** Indicates that the principal document associated with the access token is invalid.\n* **`ACCESS_TOKEN_SECRET_FAILURE`:** Represents an exception that occurs when there is a failure related to the secret required for creating an access token.\n* **`REFRESH_TOKEN_ENCODING_FAILURE`:** Represents an exception that occurs during the encoding process of a refresh token.\n* **`REFRESH_TOKEN_CREATION_FAILURE`:** Thrown when a generic exception occurred during the creation of an access token.\n* **`REFRESH_TOKEN_INVALID_PRINCIPAL_DOCUMENT_FAILURE`:** Indicates that the principal document associated with the access token is invalid.\n* **`REFRESH_TOKEN_SECRET_FAILURE`:** Represents an exception that occurs when there is a failure related to the secret required for creating a refresh token.\n* **`REFRESH_TOKEN_SESSION_UPDATE_FAILURE`:** Thrown when an exception occurs when updating the user sessions after creating a new refresh token.\n* **`STEP_UP_TOKEN_ENCODING_FAILURE`:** Represents an exception that occurs during the encoding process of a step-up token.\n* **`STEP_UP_TOKEN_SECRET_FAILURE`:** Represents an exception that occurs when there is a failure related to the secret required for creating a refresh token.\n* **`INVALID_PRINCIPAL_DOCUMENT`:** A requested principal document was stored in an invalid format.","content":{"application/json":{"schema":{"type":"object","properties":{"timestamp":{"type":"string"},"status":{"type":"integer","format":"int32"},"code":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["code","error","status","timestamp"],"title":"ErrorResponse"}}}}}}
>
  
</StatusCodes>


      