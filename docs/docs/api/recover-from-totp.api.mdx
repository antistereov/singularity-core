---
id: recover-from-totp
title: "Recover From TOTP"
description: "Recover the user if they lost access to their 2FA device using a recovery `code`."
sidebar_label: "Recover From TOTP"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/singularity-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Recover From TOTP"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/auth/2fa/totp/recover"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Recover the user if they lost access to their 2FA device using a recovery `code`.
Each `code` is only valid once.

You can learn more about recovery for TOTP [here](../../docs/guides/auth/two-factor#recovery).

**Requirements:**
- The user can authenticate using password.
- The user enabled TOTP as 2FA method.

**Optional session data:**
- The `session` object can be included in the request body.
- Inside the `session` object, you can provide the following optional fields:
    - `browser`: The name of the browser used (e.g., "Chrome", "Firefox").
    - `os`: The operating system of the device (e.g., "Windows", "macOS", "Android").

**Tokens:**
- A valid [`TwoFactorAuthenticationToken`](../../docs/guides/auth/tokens#two-factor-authentication-token)
  is required. This token will be set automatically as HTTP-only cookie through 
  [`POST /api/auth/login`](../../docs/api/login) or
  [`POST /api/auth/step-up`](../../docs/api/step-up)
  or can be retrieved from any of those endpoints' response and set as header manually if [header authentication](../../docs/guides/authentication#header-authentication) 
  is enabled.
- If this action is successful, [`AccessToken`](../../docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](../../docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  will automatically be set as HTTP-only cookies.
  
  If [header authentication](../../docs/guides/auth/authentication#header-authentication) is enabled,
  [`AccessToken`](../../docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](../../docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  will be returned in the response body and can be used in the authorization header for upcoming requests.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={undefined}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"string"},"session":{"type":"object","properties":{"browser":{"type":"string","description":"The name of the browser used.","example":"Chrome"},"os":{"type":"string","description":"The operating system of the device.","example":"WIndows"}},"title":"SessionInfoRequest"}},"required":["code"],"title":"TotpRecoveryRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Recovery successful. If header authentication is enabled, the response will contain all tokens.","content":{"*/*":{"schema":{"type":"object","properties":{"user":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"name":{"type":"string"},"email":{"type":"string"},"identityProviders":{"type":"array","items":{"type":"string"}},"roles":{"type":"array","items":{"type":"string","enum":["USER","ADMIN","GUEST"]},"uniqueItems":true},"emailVerified":{"type":"boolean"},"lastActive":{"type":"string"},"twoFactorAuthEnabled":{"type":"boolean"},"preferredTwoFactorMethod":{"type":"string","enum":["totp","mail"]},"twoFactorMethods":{"type":"array","items":{"type":"string","enum":["totp","mail"]}},"avatar":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"key":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"},"access":{"type":"object","properties":{"ownerId":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"visibility":{"type":"string","enum":["PRIVATE","PUBLIC","SHARED"]},"users":{"type":"object","properties":{"admin":{"type":"array","items":{"type":"string"},"uniqueItems":true},"editor":{"type":"array","items":{"type":"string"},"uniqueItems":true},"viewer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"isEmpty":{"type":"boolean"}},"required":["admin","editor","isEmpty","viewer"],"title":"ContentAccessPermissions"},"groups":{"type":"object","properties":{"admin":{"type":"array","items":{"type":"string"},"uniqueItems":true},"editor":{"type":"array","items":{"type":"string"},"uniqueItems":true},"viewer":{"type":"array","items":{"type":"string"},"uniqueItems":true},"isEmpty":{"type":"boolean"}},"required":["admin","editor","isEmpty","viewer"],"title":"ContentAccessPermissions"},"invitations":{"type":"array","items":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"uniqueItems":true}},"required":["groups","invitations","ownerId","users","visibility"],"title":"ContentAccessDetails"},"contentType":{"type":"string"},"url":{"type":"string"},"size":{"type":"integer","format":"int64"},"trusted":{"type":"boolean"},"tags":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["access","contentType","createdAt","id","key","size","tags","trusted","updatedAt","url"],"title":"FileMetadataResponse"},"created":{"type":"string"},"groups":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["created","emailVerified","groups","id","identityProviders","lastActive","name","roles","twoFactorAuthEnabled","twoFactorMethods"],"title":"UserResponse"},"accessToken":{"type":"string"},"refreshToken":{"type":"string"},"stepUpToken":{"type":"string"},"sessionToken":{"type":"string"}},"required":["user"],"title":"TwoFactorRecoveryResponse"}}}},"400":{"description":"TOTP is disabled.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}},"401":{"description":"Wrong code or invalid or expired `TwoFactorAuthenticationToken`.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}}}}
>
  
</StatusCodes>


      