---
id: recover-from-totp
title: "Recover From TOTP"
description: "Recover the user if they lost access to their 2FA device using a recovery `code`."
sidebar_label: "Recover From TOTP"
hide_title: true
hide_table_of_contents: true
api: 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
sidebar_class_name: "post api-method"
info_path: docs/api/singularity-api
custom_edit_url: null
---

import MethodEndpoint from "@theme/ApiExplorer/MethodEndpoint";
import ParamsDetails from "@theme/ParamsDetails";
import RequestSchema from "@theme/RequestSchema";
import StatusCodes from "@theme/StatusCodes";
import OperationTabs from "@theme/OperationTabs";
import TabItem from "@theme/TabItem";
import Heading from "@theme/Heading";

<Heading
  as={"h1"}
  className={"openapi__heading"}
  children={"Recover From TOTP"}
>
</Heading>

<MethodEndpoint
  method={"post"}
  path={"/api/auth/2fa/totp/recover"}
  context={"endpoint"}
>
  
</MethodEndpoint>



Recover the user if they lost access to their 2FA device using a recovery `code`.
Each `code` is only valid once.

You can learn more about recovery for TOTP [here](../../docs/guides/auth/two-factor#recovery).

### Requirements
- The user can authenticate using password.
- The user enabled TOTP as 2FA method.

**Optional session data:**
- The `session` object can be included in the request body.
- Inside the `session` object, you can provide the following optional fields:
    - `browser`: The name of the browser used (e.g., "Chrome", "Firefox").
    - `os`: The operating system of the device (e.g., "Windows", "macOS", "Android").

### Tokens
- A valid [`TwoFactorAuthenticationToken`](../../docs/guides/auth/tokens#two-factor-authentication-token)
  is required. This token will be set automatically as HTTP-only cookie through 
  [`POST /api/auth/login`](../../docs/api/login) or
  [`POST /api/auth/step-up`](../../docs/api/step-up)
  or can be retrieved from any of those endpoints' response and set as header manually if [header authentication](../../docs/guides/auth/authentication#header-authentication) 
  is enabled.
- If this action is successful, [`AccessToken`](../../docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](../../docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  will automatically be set as HTTP-only cookies.
  
  If [header authentication](../../docs/guides/auth/authentication#header-authentication) is enabled,
  [`AccessToken`](../../docs/guides/auth/tokens#access-token), 
  [`RefreshToken`](../../docs/guides/auth/tokens#refresh-token) and
  [`StepUpToken`](../../docs/guides/auth/tokens#step-up-token)
  will be returned in the response body and can be used in the authorization header for upcoming requests.

<Heading
  id={"request"}
  as={"h2"}
  className={"openapi-tabs__heading"}
  children={"Request"}
>
</Heading>

<ParamsDetails
  parameters={undefined}
>
  
</ParamsDetails>

<RequestSchema
  title={"Body"}
  body={{"content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"string"},"session":{"type":"object","properties":{"browser":{"type":"string","description":"The name of the browser used.","example":"Chrome"},"os":{"type":"string","description":"The operating system of the device.","example":"WIndows"}},"title":"SessionInfoRequest"}},"required":["code"],"title":"TotpRecoveryRequest"}}},"required":true}}
>
  
</RequestSchema>

<StatusCodes
  id={undefined}
  label={undefined}
  responses={{"200":{"description":"Recovery successful. If header authentication is enabled, the response will contain all tokens.","content":{"*/*":{"schema":{"type":"object","properties":{"user":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"name":{"type":"string"},"email":{"type":"string"},"identityProviders":{"type":"array","items":{"type":"string"}},"roles":{"type":"array","items":{"type":"string","enum":["USER","ADMIN","GUEST"]},"uniqueItems":true},"emailVerified":{"type":"boolean"},"lastActive":{"type":"string"},"twoFactorAuthEnabled":{"type":"boolean"},"preferredTwoFactorMethod":{"type":"string","enum":["totp","email"]},"twoFactorMethods":{"type":"array","items":{"type":"string","enum":["totp","email"]}},"avatar":{"type":"object","properties":{"id":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"key":{"type":"string"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"},"access":{"type":"object","properties":{"ownerId":{"type":"object","properties":{"timestamp":{"type":"integer","format":"int32"},"date":{"type":"string","format":"date-time"}},"title":"ObjectId"},"visibility":{"type":"string","enum":["PRIVATE","PUBLIC","SHARED"]},"canEdit":{"type":"boolean"},"canDelete":{"type":"boolean"}},"required":["canDelete","canEdit","ownerId","visibility"],"title":"ContentAccessDetailsResponse"},"renditions":{"type":"object","additionalProperties":{"type":"object","properties":{"key":{"type":"string"},"size":{"type":"integer","format":"int64"},"contentType":{"type":"string"},"url":{"type":"string"},"width":{"type":"integer","format":"int32"},"height":{"type":"integer","format":"int32"}},"required":["contentType","key","size","url"],"title":"FileRenditionResponse"}}},"required":["access","createdAt","id","key","renditions","updatedAt"],"title":"FileMetadataResponse"},"createdAt":{"type":"string"},"groups":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["createdAt","emailVerified","groups","id","identityProviders","lastActive","name","roles","twoFactorAuthEnabled","twoFactorMethods"],"title":"UserResponse"},"accessToken":{"type":"string"},"refreshToken":{"type":"string"},"stepUpToken":{"type":"string"},"sessionToken":{"type":"string"}},"required":["user"],"title":"TwoFactorRecoveryResponse"}}}},"400":{"description":"TOTP is disabled.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}},"401":{"description":"Wrong code or invalid or expired `TwoFactorAuthenticationToken`.","content":{"*/*":{"schema":{"type":"object","properties":{"timestamp":{"type":"string","format":"date-time"},"status":{"type":"integer","format":"int32"},"error":{"type":"string"},"message":{"type":"string"},"path":{"type":"string"}},"required":["error","status","timestamp"],"title":"ErrorResponse"}}}}}}
>
  
</StatusCodes>


      